---
marp: true
theme: default
paginate: true
size: 16:9
---

# PatchCore を用いた

## 異常検知アプリケーションの開発

Team H / AI 研修発表
発表者：近藤 大夢・石井 貴啓
日付：2025 年 7 月 22 日

---

## 背景と目的

「本プロジェクトは、製造現場における外観検査の自動化を目的としています。  
実際の現場では不良品の発生頻度が非常に低く、教師あり学習に必要なラベル付きの異常画像が十分に集められない課題があります。  
そこで今回は、正常画像のみで学習できる教師なし学習を活用し、異常検知モデルとそのアプリ化に取り組みました。」

---

## 前回の取り組みと課題

「前回は VAE というモデルを用いて、正常画像との再構成誤差から異常を検出する手法を試しました。  
このとき、SSIM という類似度指標で判定を行いましたが、異常箇所がモザイク状に表示されたり、正常でも誤判定されるケースがありました。  
また、画像の向きや明るさの違いに弱く、実用化には課題が残りました。」

---

## 改善方針

「これらの課題を踏まえて、今回の発表では PatchCore という手法を用いて異常検知を行いました。  
PatchCore は画像をパッチに分割して特徴を比較するため、局所的な異常に強く、類似度の閾値に過度に依存しないという特徴があります。  
また、今回は事前処理として、画像の向きや明るさも統一し、前回の問題点を改善しました。」

---

## PatchCore の仕組み

- 正常画像のパッチ特徴を保存（Memory Bank）
- 推論時、入力画像の各パッチと距離を計算し、異常スコアを算出
- スコアマップを生成し、異常領域を可視化
- ResNet をバックボーンとし、高精度な特徴抽出が可能

---

### 発表原稿：

「PatchCore では、まず正常な画像のパッチごとに特徴量を抽出し、それらをメモリとして保存しておきます。  
推論時には、検査画像の各パッチと正常メモリとの距離を計算し、どれくらい異常かというスコアを生成します。  
このスコアを画像上に可視化することで、どこに異常があるかを明示的に示すことができます。」

---

## システム構成

「システムは前回と同様に、クライアントとサーバーに分かれた構成です。  
クライアントから画像をアップロードし、サーバー側の Python で PatchCore モデルを用いて推論を行います。  
その結果、異常スコアマップや判定結果をクライアントに返し、表示する仕組みです。」

---

「PatchCore を適用してみたところ、最初は正常画像でも異常スコアが高く出てしまうという問題が発生しました。
その原因として、Core-Set の圧縮による特徴欠損や、正規化不足による距離スケールのずれが疑われました。
これらを調整した結果、モデル精度は改善され、ROC-AUC も 0.8 を超える結果が得られました。
ただし、背景の一部にも異常と誤検出する傾向が残っており、今後はヒートマップの最適化やマスク処理なども検討していきたいと考えています。」
